# How to Debug a Failing Test in This Project

> Auto-generated by ariadne from project pattern analysis.

## Step-by-Step Debugging Process

1. **Get context**: Call `get_context_capsule` with `intent="debug"` and the failing model name
   ```
   get_context_capsule("debug failing test on <model_name>")
   ```

2. **Check run results**: Look at `target/run_results.json` for the exact error message

3. **Trace upstream**: This project's test failures are typically caused by:
   - Source freshness issues — check `sources.md` for freshness configuration
   - NULL propagation from the staging layer — check `not_null` tests upstream
   - Accepted values drift — new enum values in source data not in the test

4. **For `not_null` failures**: Trace the column upstream with `get_lineage`
   - Check if the source table has NULLs
   - Check if a JOIN introduces NULLs (LEFT JOIN vs INNER JOIN)

5. **For `accepted_values` failures**: Check the SOURCE table directly
   - The source may have new values not present when the test was written
   - Update the test's `values` list or add the new value to the accepted set

6. **For `unique` failures**: Check for fan-out in JOINs
   - A many-to-one JOIN can duplicate rows unexpectedly
   - Check if the grain of the model matches the primary key definition

7. **For `relationships` failures**: The referenced column/table may have changed
   - Verify the upstream model still has the referenced column

## Project-Specific Notes
- **Adapter**: {{ stats.adapter_type }}
- **Test coverage**: ~{{ stats.test_coverage_pct }}% of columns have tests

## Common Test Failure Patterns
{% if stats.adapter_type == "bigquery" -%}
- BigQuery: `INT64` vs `FLOAT64` type mismatches in `accepted_values`
- BigQuery: case sensitivity in string comparisons
{% elif stats.adapter_type == "snowflake" -%}
- Snowflake: `VARIANT` columns require CAST before comparison
- Snowflake: case-insensitive by default — check if tests expect specific case
{% elif stats.adapter_type == "redshift" -%}
- Redshift: `VARCHAR` length limits can cause silent truncation
{% else -%}
- Check adapter-specific type handling for your warehouse ({{ stats.adapter_type }})
{% endif %}

## Useful Commands
```bash
# Re-run a specific failing test
dbt test --select test_name

# Run tests on a specific model
dbt test --select model_name

# See test results detail
dbt test --select model_name --store-failures
```

## After Fixing
1. Re-run `dbt test --select <model_name>` to verify the fix
2. Call `refresh_index` to update run results in the context engine
